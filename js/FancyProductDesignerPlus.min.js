/*
* Fancy Product Designer Plus 1.1.9 
* An Add-On for Fancy Product Designer. 
* Copyright 2016, Rafael Dery
*
* Only for the sale at the envato marketplaces
*/

var FPDBulkVariations=function(r){"use strict";$=jQuery;var s=this,o=$(r.mainOptions.bulkVariationsPlacement).addClass("fpd-bulk-variations fpd-container"),l=r.mainOptions.bulkVariations,d="";this.getOrderVariations=function(){var i=[];return o.find(".fpd-row").each(function(e,n){var n=$(n),t={};n.children(".fpd-select-col").each(function(e,n){n=$(n).find("select");null==n.val()&&(i=!1,n.addClass("fpd-error")),t[n.attr("name")]=n.val()}),!1!==i&&i.push({variation:t,quantity:parseInt(n.find(".fpd-quantity").val())})}),i},this.setup=function(e){"object"==typeof e&&(o.children(".fpd-variations-list").empty(),e.forEach(function(n){o.children(".fpd-variations-list").append(d);var t=o.children(".fpd-variations-list").children(".fpd-row:last");Object.keys(n.variation).forEach(function(e){t.find('select[name="'+e+'"]').val(n.variation[e])}),t.find(".fpd-quantity").val(n.quantity)})),c()};var c=function(){var e=0;o.find(".fpd-quantity").each(function(){e+=Number(this.value)}),r.setOrderQuantity(Number(e))};!function(){if(r.$container.on("getOrder",function(){r._order.bulkVariations=s.getOrderVariations()}),"object"==typeof l){var e=Object.keys(l);d+='<div class="fpd-row">';for(var n=0;n<e.length;++n){var t=e[n],i=l[t];d+='<div class="fpd-select-col"><select name="'+t+'"><option value="" disabled selected>'+t+"</option>";for(var a=0;a<i.length;++a)d+='<option value="'+i[a]+'">'+i[a]+"</option>";d+="</select></div>"}d+='<div><input type="number" class="fpd-quantity" step="1" min="1" value="1" /></div>',d+='<div class="fpd-remove-row"><span class="fpd-icon-close"></span></div>',d+="</div>"}o.append('<div class="fpd-variations-list">'+d+"</div>").prepend('<div class="fpd-clearfix"><span class="fpd-title fpd-left">'+r.getTranslation("plus","bulk_add_variations_title")+'</span><span class="fpd-add-row fpd-btn fpd-right">'+r.getTranslation("plus","bulk_add_variations_add")+"</span></div>"),o.on("click",".fpd-add-row",function(){o.children(".fpd-variations-list").append(d),c()}),o.on("click",".fpd-remove-row",function(){var e=$(this).parents(".fpd-row:first");0<e.siblings(".fpd-row").length&&(e.remove(),c())}),o.on("change","select",function(){$(this).removeClass("fpd-error")}),o.on("change",".fpd-quantity",function(){var e=$(this);this.value<Number(e.attr("min"))&&(this.value=Number(e.attr("min"))),""==this.value&&(this.value=1),c()}),c()}()},FPDColorSelection=function(o){"use strict";$=jQuery;var l=null,d=!1,c=o.mainOptions.colorSelectionPlacement,p=function(i,a,r){$.isArray(i.patterns)&&(FPDUtil.isSVG(i)||"text"===FPDUtil.getType(i.type))&&i.patterns.forEach(function(e){var n=e.replace(/^.*[\\\/]/,"").replace(/\.[^/.]+$/,"").replace("_"," "),t=r?'<div class="fpd-label">'+n+"</div>":"";a.append('<div data-pattern="'+e+'" style="background-image: url('+e+')" class="fpd-item fpd-tooltip fpd-pattern" title="'+n+'">'+t+"</div>"),a.find(".fpd-item:last").click(function(){var e=$(this).data("pattern");o.deselectElement(),o.currentViewInstance.currentUploadZone=null,o.viewInstances[0].setElementParameters({pattern:e},i)})})};o.$container.on("productCreate",function(){var e=o.getElements(0).filter(function(e){return e.showInColorSelection});0<e.length?(null==l&&(l=-1!==c.indexOf("inside-")?o.$mainWrapper.append('<div class="fpd-color-selection fpd-inside-main fpd-clearfix fpd-'+c+'"></div>').children(".fpd-color-selection"):$(c).addClass("fpd-color-selection fpd-clearfix fpd-custom-pos")),l.find("input").spectrum("destroy"),l.empty(),-1!==c.indexOf("inside-")&&(e=[e[0]]),e.forEach(function(e){!function(t){var e=$('<div class="fpd-cs-item" data-id="'+t.id+'"><div class="fpd-title">'+t.title+'</div><div class="fpd-colors"></div></div>');if(FPDUtil.elementHasColorSelection(t)){l.append(e);var n=FPDUtil.elementAvailableColors(t,o);if(t.type==FPDPathGroupName&&1<t.getObjects().length){for(var i=0;i<n.length;++i)e.children(".fpd-colors").append('<input type="text" value="'+n[i]+'" />');e.find(".fpd-colors input").spectrum({showPaletteOnly:$.isArray(t.colors),preferredFormat:"hex",showInput:!0,showInitial:!0,showButtons:!1,showPalette:o.mainOptions.colorPickerPalette&&0<o.mainOptions.colorPickerPalette.length,palette:$.isArray(t.colors)?t.colors:o.mainOptions.colorPickerPalette,show:function(e){var n=$(this).parent(".fpd-colors"),e=FPDUtil.changePathColor(t,n.children("input").index(this),e);FPDUtil.spectrumColorNames($(this).spectrum("container"),o),t._tempFill=e},move:function(e){var n=$(this).parent(".fpd-colors"),e=FPDUtil.changePathColor(t,n.children("input").index(this),e);o.currentViewInstance.changeColor(t,e)},change:function(e){var n=$(this).parent(".fpd-colors"),e=FPDUtil.changePathColor(t,n.find("input").index(this),e);$(document).unbind("click.spectrum"),o.currentViewInstance.setElementParameters({fill:e},t)}})}else if(1!=n&&(1<n.length||t.type==FPDPathGroupName&&1===t.getObjects().length)){var a=!1;"dropdown"==o.mainOptions.colorSelectionDisplayType&&-1==c.indexOf("inside-")&&(e.addClass("fpd-dropdown").children(".fpd-title").append('<span class="fpd-icon-arrow-dropdown"></span>'),a=!0);for(i=0;i<n.length;++i){var r=n[i],s=(s=o.mainOptions.hexNames[r.replace("#","").toLowerCase()])||r;"string"==typeof r&&4==r.length&&(r+=r.substr(1,r.length)),e.find(".fpd-colors").append('<div data-color="'+r+'" style="background-color: '+r+'" class="fpd-item fpd-tooltip" title="'+s+'"><div class="fpd-label">'+(a?s:r)+"</div></div>"),e.find(".fpd-item:last").click(function(){var e=tinycolor($(this).css("backgroundColor"));o.deselectElement(),o.currentViewInstance.currentUploadZone=null;var n=e.toHexString();t.type==FPDPathGroupName&&(n=FPDUtil.changePathColor(t,0,e)),o.viewInstances[0].setElementParameters({fill:n},t)})}p(t,e.find(".fpd-colors"),a),FPDUtil.updateTooltip(e)}else e.children(".fpd-colors").append('<input type="text" value="'+t.colors[0]+'" />'),e.find("input").spectrum({showButtons:!1,preferredFormat:"hex",showInput:!0,showInitial:!0,showPalette:o.mainOptions.colorPickerPalette&&0<o.mainOptions.colorPickerPalette.length,palette:o.mainOptions.colorPickerPalette,show:function(e){FPDUtil.spectrumColorNames($(this).spectrum("container"),o),t._tempFill=e.toHexString()},move:function(e){!1!==d&&"png"===FPDUtil.elementIsColorizable(t)||o.viewInstances[0].changeColor(t,e.toHexString())},change:function(e){$(document).unbind("click.spectrum"),o.viewInstances[0].setElementParameters({fill:e.toHexString()},t)}}).on("dragstart.spectrum",function(){d=!0}).on("dragstop.spectrum",function(e,n){d=!1,o.viewInstances[0].changeColor(t,n.toHexString())})}}(e)}),l.off().on("click",".fpd-dropdown > .fpd-title",function(){$(this).next(".fpd-colors").toggleClass("fpd-active").parent(".fpd-dropdown").siblings(".fpd-dropdown").children(".fpd-colors").removeClass("fpd-active")}),l.show()):l&&l.hide()}).on("elementRemove",function(e,n){n.showInColorSelection&&l.children('[data-id="'+n.id+'"]').find("input").spectrum("destroy").remove()}).on("elementColorChange",function(e,n,t){l&&"string"==typeof t&&l.children('[data-id="'+n.id+'"]').find('.fpd-colors > [data-color="'+t+'"]').addClass("fpd-active").siblings().removeClass("fpd-active")})},FPDDrawingModule=function(n,a){"use strict";$=jQuery,this.drawCanvas=null;function t(e,n){if("vLine"===n){var t=new fabric.PatternBrush(e);return t.getPatternSrc=function(){var e=fabric.document.createElement("canvas");e.width=e.height=10;var n=e.getContext("2d");return n.strokeStyle=this.color,n.lineWidth=5,n.beginPath(),n.moveTo(0,5),n.lineTo(10,5),n.closePath(),n.stroke(),e},t}if("hLine"===n){e=new fabric.PatternBrush(e);return e.getPatternSrc=function(){var e=fabric.document.createElement("canvas");e.width=e.height=10;var n=e.getContext("2d");return n.strokeStyle=this.color,n.lineWidth=5,n.beginPath(),n.moveTo(5,0),n.lineTo(5,10),n.closePath(),n.stroke(),e},e}}var r=this,s="#000000",o="Pencil";!function(){a.find(".fpd-drawing-brush-type .fpd-item").click(function(e){e.stopPropagation();var n=$(this),t=n.parent().prevAll(".fpd-dropdown-current:first"),e=n.data("value");t.html(n.clone()).data("value",e),o=e,r.drawCanvas.freeDrawingBrush=i(e),r.drawCanvas.freeDrawingBrush&&(r.drawCanvas.freeDrawingBrush.color=s,r.drawCanvas.freeDrawingBrush.width=a.find(".fpd-drawing-line-width").val()),n.parents(".fpd-dropdown:first").removeClass("fpd-active")}),a.find(".fpd-drawing-line-color").spectrum({color:s,showButtons:!1,preferredFormat:"hex",showInput:!0,showInitial:!0,showPalette:n.mainOptions.colorPickerPalette&&0<n.mainOptions.colorPickerPalette.length,palette:n.mainOptions.colorPickerPalette,move:function(e){s=e.toHexString(),r.drawCanvas&&(r.drawCanvas.freeDrawingBrush.color=s)},change:function(e){s=e.toHexString(),r.drawCanvas&&(r.drawCanvas.freeDrawingBrush.color=s)}}),a.find(".fpd-slider-range").rangeslider({polyfill:!1,rangeClass:"fpd-range-slider",disabledClass:"fpd-range-slider--disabled",horizontalClass:"fpd-range-slider--horizontal",verticalClass:"fpd-range-slider--vertical",fillClass:"fpd-range-slider__fill",handleClass:"fpd-range-slider__handle",onSlide:function(e,n){this.$element.parent().siblings(".fpd-slider-number").val(n).change()}}),a.find(".fpd-slider-number").change(function(){var e=$(this);this.value>Number(e.attr("max"))&&(this.value=Number(e.attr("max"))),this.value<Number(e.attr("min"))&&(this.value=Number(e.attr("min"))),e.next(".fpd-range-wrapper").children("input").val(this.value).rangeslider("update",!0,!1),e.hasClass("fpd-drawing-line-width")&&r.drawCanvas&&(r.drawCanvas.freeDrawingBrush.width=this.value)}),a.on("click",".fpd-clear-drawing",function(){r.drawCanvas.dispose(),e()}),a.on("click",".fpd-add-drawing",function(){var e=r.drawCanvas.toSVG({suppressPreamble:!0}).replace(/(?:\r\n|\r|\n)/g,"");n.addElement("image",e,(new Date).getTime(),$.extend({},n.currentViewInstance.options.customImageParameters,{autoCenter:!0,draggable:!0,resizable:!0,removable:!0,rotatable:!0,autoSelect:!0,colors:!1,patterns:!1,isCustom:!0})),r.drawCanvas.clear()});var i=function(e){return"hline"===e?t(r.drawCanvas,"hLine"):"vline"===e?t(r.drawCanvas,"vLine"):new fabric[e+"Brush"](r.drawCanvas)},e=function(){var e=(e=(0<a.parents(".fpd-draggable-dialog:first").length?a.parents(".fpd-draggable-dialog:first"):a.parent(".fpd-content")).width())||300;e-=2*parseInt(a.css("paddingLeft")),r.drawCanvas=new fabric.Canvas(a.find(".fpd-drawing-canvas").get(0),{containerClass:"fpd-drawing-container",isDrawingMode:!0,width:e,height:150}),r.drawCanvas.freeDrawingBrush=i(o),r.drawCanvas.freeDrawingBrush.color=s,r.drawCanvas.freeDrawingBrush.width=a.find("input.fpd-drawing-line-width").val()};e()}()},FPDNamesNumbersModule={setup:function(l,d){var t=null;d.off().find(".fpd-list").empty();function i(e,n){l.currentViewInstance.numberPlaceholder&&"string"==typeof e&&l.currentViewInstance.setElementParameters({text:e},l.currentViewInstance.numberPlaceholder),l.currentViewInstance.textPlaceholder&&"string"==typeof n&&(l.mainOptions.disableTextEmojis&&(n=(n=n.replace(FPDEmojisRegex,"")).replace(String.fromCharCode(65039),"")),l.currentViewInstance.setElementParameters({text:n},l.currentViewInstance.textPlaceholder)),l.currentViewInstance.stage.renderAll()}function n(e,n,t){e=void 0===e?"":e,n=void 0===n?"":n;var i,a='<div class="fpd-row">';if(l.currentViewInstance.numberPlaceholder&&(i="",Array.isArray(l.currentViewInstance.numberPlaceholder.numberPlaceholder)&&(i='min="'+l.currentViewInstance.numberPlaceholder.numberPlaceholder[0]+'" max="'+l.currentViewInstance.numberPlaceholder.numberPlaceholder[1]+'" '),a+='<div class="fpd-number-col"><input type="number" placeholder="'+l.currentViewInstance.numberPlaceholder.originParams.text+'" class="fpd-number" value="'+e+'" '+i+" /></div>"),l.currentViewInstance.textPlaceholder&&(a+='<div class="fpd-name-col"><div><input type="text" placeholder="'+l.currentViewInstance.textPlaceholder.originParams.text+'" value="'+n+'" /></div></div>'),l.mainOptions.namesNumbersDropdown&&0<l.mainOptions.namesNumbersDropdown.length||t){for(var n=[t],r=0<l.mainOptions.namesNumbersDropdown.length?l.mainOptions.namesNumbersDropdown:n,s="",o=0;o<r.length;++o)selected=t===r[o]?'selected="selected"':"",s+='<option value="'+r[o]+'" '+selected+">"+r[o]+"</option>";a+='<div class="fpd-select-col"><label><select>'+s+"</select></label></div>"}return a+='<div class="fpd-remove-col"><span><span class="fpd-icon-remove"></span></span></div></div></div>',d.find(".fpd-list").append(a),FPDUtil.createScrollbar(d.find(".fpd-scroll-area")),d.find(".fpd-list .fpd-row:last")}if(l.currentViewInstance.textPlaceholder||l.currentViewInstance.numberPlaceholder)if(d.children(".fpd-names-numbers-panel").toggleClass("fpd-disabled",!1),l.currentViewInstance.names_numbers&&Array.isArray(l.currentViewInstance.names_numbers))for(var e=0;e<l.currentViewInstance.names_numbers.length;++e){var a=l.currentViewInstance.names_numbers[e];n(a.number,a.name,a.select)}else n();else d.children(".fpd-names-numbers-panel").toggleClass("fpd-disabled",!0);d.on("click",".fpd-remove-col",function(){var e=$(this).parents(".fpd-row:first");0<e.siblings(".fpd-row").length&&(e.remove(),t&&t.get(0)===e.get(0)&&d.find(".fpd-row:first input:first").mouseup(),l.currentViewInstance.names_numbers=FPDNamesNumbersModule.getViewNamesNumbers(d),l.currentViewInstance.changePrice(l.currentViewInstance.options.namesNumbersEntryPrice,"-"))}),d.on("mouseup keyup",".fpd-row input",function(){var e,n=$(this);t&&t.get(0)!==n.parents(".fpd-row:first").get(0)?(e=n.parents(".fpd-row:first"),i(e.find(".fpd-number").val(),e.find(".fpd-name-col input").val())):(0!=(e=(n.hasClass("fpd-number")?l.currentViewInstance.numberPlaceholder:l.currentViewInstance.textPlaceholder).maxLength)&&this.value.length>e&&(this.value=this.value.substr(0,e)),n.hasClass("fpd-number")?(void 0!==n.attr("min")&&""!==this.value&&(this.value>Number(n.attr("max"))&&(this.value=Number(n.attr("max"))),this.value<Number(n.attr("min"))&&(this.value=Number(n.attr("min")))),i(this.value)):i(!1,this.value)),t=n.parents(".fpd-row:first")}),d.on("click",".fpd-btn",function(){var e=n();d.find(".fpd-list .fpd-row:last input:first").focus(),i(e.find(".fpd-number").attr("placeholder"),e.find(".fpd-name-col input").attr("placeholder")),l.currentViewInstance.names_numbers=FPDNamesNumbersModule.getViewNamesNumbers(d),l.currentViewInstance.changePrice(l.currentViewInstance.options.namesNumbersEntryPrice,"+"),t=e}),d.on("change","input, select",function(){l.currentViewInstance.names_numbers=FPDNamesNumbersModule.getViewNamesNumbers(d)})},getViewNamesNumbers:function(e){var i=[];return e.find(".fpd-list .fpd-row").each(function(e,n){var t=$(n),n={};0<t.children(".fpd-number-col").length&&(n.number=t.find(".fpd-number").val()),0<t.children(".fpd-name-col").length&&(n.name=t.find(".fpd-name-col input").val()),0<t.children(".fpd-select-col").length&&(n.select=t.find(".fpd-select-col select").val()),i.push(n)}),i}},FPDDynamicViews=function(s,o){"use strict";$=jQuery;function a(e,n){return"width"==e?n.value<c?n.value=c:n.value>u&&(n.value=u):n.value<p?n.value=p:n.value>f&&(n.value=f),n.value}var r=null,l=s.mainOptions.dynamicViewsOptions.unit,d=s.mainOptions.dynamicViewsOptions.formats,c=s.mainOptions.dynamicViewsOptions.minWidth,p=s.mainOptions.dynamicViewsOptions.minHeight,u=s.mainOptions.dynamicViewsOptions.maxWidth,f=s.mainOptions.dynamicViewsOptions.maxHeight,m=[],h=null;o.find(".fpd-list").sortable({placeholder:"fpd-item fpd-sortable-placeholder",items:".fpd-item",cancel:"input",handle:".fpd-view-thumbnail",scroll:!1,axis:"y",start:function(e,n){h=n.item.index()},update:function(e,n){var t,i=n.item.index(),a=s.$productStage.children(".fpd-view-stage"),r=s.$viewSelectionWrapper.find(".fpd-item");0==i?(a.eq(h).insertBefore(a.eq(0)),r.eq(h).insertBefore(r.eq(0))):i<h?(a.eq(h).insertBefore(a.eq(i)),r.eq(h).insertBefore(r.eq(i))):(a.eq(h).insertAfter(a.eq(i)),r.eq(h).insertAfter(r.eq(i))),t=s.viewInstances,n=i,r=t[a=h],t.splice(a,1),t.splice(n,0,r),h==s.currentViewIndex&&s.selectView(i)}}),s.$container.on("productSelect",function(){o.find(".fpd-list").empty()}).on("productCreate",function(){s.currentViewInstance.options.layouts&&0<s.currentViewInstance.options.layouts.length?o.find(".fpd-add-from-layouts").removeClass("fpd-hidden"):o.find(".fpd-add-from-layouts").addClass("fpd-hidden")}).on("uiSet",function(e,n){var t,i=s.mainBar.$content.find(".fpd-dynamic-views-blank");$.isArray(d)&&0<d.length&&(t=i.find(".fpd-blank-formats").removeClass("fpd-hidden"),d.forEach(function(e,n){$("<span/>",{class:"fpd-item","data-value":n,html:e[0]+" x "+e[1]}).appendTo(t.find(".fpd-dropdown-list"))})),i.find(".fpd-dynamic-views-unit").text(l),s.mainBar.$content.on("click",".fpd-blank-formats .fpd-item",function(){var e=$(this).data("value");s.mainBar.$content.find(".fpd-blank-custom-size .fpd-width").val(d[e][0]).nextAll("input:first").val(d[e][1])}).on("click",".fpd-dynamic-views-blank .fpd-btn",function(){var n=!0,t={};i.find(".fpd-blank-custom-size input").each(function(){var e=$(this);0==this.value.length?(n=!1,e.addClass("fpd-error")):t[e.hasClass("fpd-width")?"stageWidth":"stageHeight"]=FPDUtil.unitToPixel(Number(this.value),l)}),n&&(t.output={width:FPDUtil.pixelToUnit(t.stageWidth,"mm"),height:FPDUtil.pixelToUnit(t.stageHeight,"mm")},r=s.viewInstances.length,s.addView({title:Date.now(),thumbnail:"",elements:[],options:t}),i.find(".fpd-blank-custom-size input").val("").removeClass("fpd-error"))}).on("click",".fpd-dynamic-views-layouts .fpd-item",function(){var e=$(this),e=e.parent().children(".fpd-item").index(e);r=s.viewInstances.length,s.addView(m[e])})}).on("viewCreate",function(e,i){null!==r&&(s.selectView(r),s.mainBar.callModule("dynamic-views"),r=null),i.toDataURL(function(e){var n=FPDUtil.pixelToUnit(i.options.stageWidth,l),t=FPDUtil.pixelToUnit(i.options.stageHeight,l);$("<div/>",{class:"fpd-item",html:'<div class="fpd-view-thumbnail"><picture style="background-image: url('+e+')"></picture></div><div class="fpd-actions"><div class="fpd-copy-view"><span class="fpd-icon-copy"></span></div><div class="fpd-dimensions"><input type="number" class="fpd-width" value="'+n+'" min="'+c+'" max="'+u+'" />x<input type="number" value="'+t+'" min="'+p+'" max="'+f+'" />'+l+'</div><div class="fpd-remove-view"><span class="fpd-icon-remove"></span></div></div>'}).appendTo(o.find(".fpd-list"));FPDUtil.createScrollbar(o.find(".fpd-scroll-area"))})}).on("viewRemove",function(e,n){o.find(".fpd-list .fpd-item").eq(n).remove()}).on("viewCanvasUpdate",function(e,n){var t,i;s.productCreated&&(t=s.$productStage.children(".fpd-view-stage").index($(n.stage.wrapperEl)),i=FPDUtil.getScalingByDimesions(n.options.stageWidth,n.options.stageHeight,250,200),n.toDataURL(function(e){o.find(".fpd-item").eq(t).find("picture").css("background-image","url("+e+")"),""===n.thumbnail&&s.$viewSelectionWrapper.find(".fpd-item").eq(t).find("picture").css("background-image","url("+e+")")},"transparent",{multiplier:i},!1,!1))}).on("secondaryModuleCalled",function(e,n,t){"fpd-dynamic-views-layouts"==n&&(t.find(".fpd-scroll-area .fpd-grid").empty(),n=s.viewInstances[0].options.layouts,$.isArray(n)&&((m=n).forEach(function(e){$("<div/>",{class:"fpd-item fpd-tooltip",title:e.title,html:'<picture style="background-image: url('+e.thumbnail+'");"></picture>'}).appendTo(t.find(".fpd-scroll-area .fpd-grid"))}),FPDUtil.updateTooltip(t.children(".fpd-scroll-area")),FPDUtil.createScrollbar(t.children(".fpd-scroll-area"))))}).on("clear",function(){o.find(".fpd-list .fpd-item").remove()}).on("viewCreate viewSizeChange",function(e,n){var t,i;s.mainOptions.dynamicViewsOptions.pricePerArea&&(t=FPDUtil.pixelToUnit(n.options.stageWidth,"cm"),i=FPDUtil.pixelToUnit(n.options.stageHeight,"cm"),FPDUtil.objectHasKeys(n.options.output,["width","height"])&&(t=n.options.output.width/10,i=n.options.output.height/10),i=Math.ceil(t*i)*Number(s.mainOptions.dynamicViewsOptions.pricePerArea),n.changePrice(0,"+",i))}),o.on("click",".fpd-btn",function(){$(this).hasClass("fpd-add-blank-view")?s.mainBar.callSecondary("fpd-dynamic-views-blank"):s.mainBar.callSecondary("fpd-dynamic-views-layouts")}).on("click",".fpd-list .fpd-item",function(){var e=o.find(".fpd-item").index($(this));s.selectView(e)}).on("change",".fpd-dimensions input",function(){var e,n,t=$(this);t.hasClass("fpd-width")?(e=FPDUtil.unitToPixel(a("width",this),l),n=FPDUtil.unitToPixel(a("height",t.siblings('input[type="number"]').get(0)),l)):(n=FPDUtil.unitToPixel(a("height",this),l),e=FPDUtil.unitToPixel(a("width",t.siblings('input[type="number"]').get(0)),l));var i=FPDUtil.pixelToUnit(e,"mm"),t=FPDUtil.pixelToUnit(n,"mm");s.currentViewInstance.options.output?(s.currentViewInstance.options.output.width=i,s.currentViewInstance.options.output.height=t):s.currentViewInstance.options.output={width:i,height:t};t=1<(t=FPDUtil.getScalingByDimesions(e,n,1e3,1e3))?1:t;s.currentViewInstance.options.stageWidth=Math.round(e*t),s.currentViewInstance.options.stageHeight=Math.round(n*t);t=!!s.currentViewInstance.options.printingBox&&s.currentViewInstance.options.printingBox.visibility;s.currentViewInstance.options.printingBox={top:0,left:0,width:s.currentViewInstance.options.stageWidth,height:s.currentViewInstance.options.stageHeight,visibility:t},s.currentViewInstance.renderPrintingBox(),s.$productStage.width(s.currentViewInstance.options.stageWidth),s.currentViewInstance.resetCanvasSize(),s.$container.trigger("viewSizeChange",[s.currentViewInstance])}).on("click",".fpd-copy-view",function(e){e.stopPropagation();for(var e=o.find(".fpd-item").index($(this).parents(".fpd-item:first")),n=s.viewInstances[e],t=n.stage.getObjects(),i=[],a=0;a<t.length;++a){var r=t[a];void 0!==r.title&&void 0!==r.source&&(r={title:r.title,source:r.source,parameters:n.getElementJSON(r),type:FPDUtil.getType(r.type)},i.push(r))}s.addView({title:n.title,thumbnail:n.thumbnail,elements:i,options:n.options})}).on("click",".fpd-remove-view",function(e){e.stopPropagation();e=o.find(".fpd-item").index($(this).parents(".fpd-item:first"));s.removeView(e)})},FancyProductDesignerPlus={version:"1.0.7",setup:function(e,n){n.mainOptions.colorSelectionPlacement&&""!==n.mainOptions.colorSelectionPlacement&&new FPDColorSelection(n),e.on("langJSONLoad",function(){var e;n.mainOptions.bulkVariationsPlacement&&n.mainOptions.bulkVariations&&(e=new FPDBulkVariations(n),n.bulkVariations=e)}),-1!=n.mainOptions.mainBarModules.indexOf("names-numbers")&&e.on("viewCreate",function(e,n){n.names_numbers&&1<n.names_numbers.length&&n.changePrice((n.names_numbers.length-1)*n.options.namesNumbersEntryPrice,"+")})},availableModules:["names-numbers","drawing","dynamic-views"]};